# RogueLike 仕様書

## 1. 導入
君はローカル・ファイターズ・ギルドにおいて学習を終えたばかりだ。練習を重ね、汗をかき、とうとう君はトレーニングを終え、危険な冒険に旅立つ準備ができた。君のスキルをテストするため、ローカル・ギルドマスターが君を運命のダンジョンへ送り込んだ。君のタスクはイェンダーの魔除けを持って、ダンジョンから生還することだ。ミッション・コンプリートの暁には、君にローカル・ギルドのフル・メンバーシップが与えられる。さらに、ダンジョンから持ち帰った戦利品は、全て君のものとなるのだ。

旅立ちの準備に、君は強化した斤、弓、そして遥か彼方ターク・マウンテンズにあるドラゴンの財宝庫からとってきた矢筒を与えられた。君はまたエルフが作った鎧を装備し、ダンジョンに到着するのに充分な食べ物も持った。家族と友達に、最後になるかもしれない別れを告げ、 旅立つのだ。

君は何日か何事もなく旅を続け、ついに運命の洞窟の入り口である古代遺跡へとたどり着いた。もう夜も遅い。君は星空の下、ダンジョンの入口でキャンプをする。次の朝、君は装備を集め、鎧を身につけ、残り僅かとなった食べ物を食べ、ダンジョンへ入るのだ。

## 2. ここで何が起きているのか?
君はローグをプレイし始めたところだ。君のゴールは、できるだけたくさんの宝を取り、イェンダーの魔除けをみつけ、運命の洞窟から生還することだ。画面には、その階で君が行った場所が記されたマップと、発見したものが表示される。別の階を探索すればまた、その階で君が通った場所のマップとそこでみつけたものが画面上で確認できる。

ローグは、スクリーン・オリエンテッドである点で、その他の殆どのコンピューター・ファンタジー・ゲームと異なっている。コマンドはすべて1つか2つのキー・ストローク1で、コマンドの結果は言葉で説明されるのではなく、画面上にグラフィカルに表示される2のだ。

ローグと他のコンピューター・ファンタジー・ゲームとのもうひとつの大きな違いは、他のゲームでは、一度パズルを解いてしまったら、そこでほとんどの興奮や楽しさは冷めてしまうのに対して、ローグは、ダンジョンが毎回自動生成されるため、ローグの制作者本人までも、プレイするたびに興奮し、楽しめるゲームであることだ。

## 3. 画面上に表示されるものの意味は?
ゲームの進行中、何が起こっているのかを知るためには、画面に表示されるものの意味をまず理解しなければいけない。ローグでは、通常のファンタジー・ゲームにおける「君は○○を見ている...」と言ったテキストでの説明の代わりに、必要な情報は図1のように画面に表示される。

____________________________________________________________


                        ------------
                        |..........+
                        |..@....]..|
                        |....B.....|
                        |..........|
                        -----+------



Level: 1  Gold: 0      Hp: 12(12)  Str: 16(16)  Arm: 4  Exp: 1/0

                            図1
____________________________________________________________
3.1. 画面下部
画面下部には、君の今のステータスに関するいくつかの謎めいた情報が表示されている。これらが意味するものは下記のとおりだ:
 

Level(階)

この数字は、君がどこまで深くダンジョンを潜ったか、を表している。1から始まって、何階まで到達したかが表示される。

Gold(ゴールド)

この数字は、君がそれまでにみつけ、保持しているゴールドの数だ。

Hp(ヘルス・ポイント)

君の現在の、およびマックスのヘルス・ポイントを表している。ヘルス・ポイントは、君が死んでしまう前にどのくらいダメージを受けられるか、を示している。戦いで打撃を受けるたび、君のヘルス・ポイントは減っていく。ヘルス・ポイントは、休憩すれば回復する。左側が現在値、()内が 最大値だ。

Str(力)

君の現在の、およびマックスの強さ(力)を示している。強さは、3から31までの整数で表され、数が大きければ大きいほど強くなる。左側が現在値、()内が君が現時点で達成している最大値だ。

Arm(鎧)

君の現在の鎧の防御力を示している。この数字は、君の鎧が、君を敵の攻撃からどのくらい効果的に守ってくれるかを表しており、数字が大きくなればなるほど、防御力が高いということになる。

Exp(経験値)

これら2つの数字は、君の現在の経験値と、レベルを表している。何かアクションを取るたび、君は経験値を得る。一定の経験値を得ると、レベルが上がる。レベルが上がれば上がるほど、君は戦いに強くなり、魔法攻撃にも耐えられるようになるのだ。

 

3.2. 画面上部
画面上部には、ビジュアルで表現しきれない情報がメッセージで表示される。“--More--”という表示は、メッセージがさらに続いていることを示している。まず、表示中のメッセージをキチンと読むこと。その後、次のメッセージを読むためには、スペースを叩けばよい。

3.3. 画面のその他の部分
画面のその他の部分には、君が探索したその階のマップが表示される。マップ上のシンボルは、さまざまなものを表している。各シンボルとその意味は、下記のとおり:

@

君、冒険者だ。

- |

部屋の壁だ。

+

部屋のドアだ。

.

部屋の床だ。

#

部屋と部屋をつなぐ廊下の床だ。

*

ゴールドの山、または大金。

)

何らかの武器。

]

鎧。

!

魔法の薬がはいったフラスコ。

?

紙切れ。魔法の巻物であることが多い。

=

魔法の指輪。

/

魔法の杖。(staff/wand)

^

罠。これらには気を付けなければいけない。

%

別の階への階段。

:

食べ物。

A-Z

大文字のアルファベットは運命の洞窟の住人たちだ。注意しろ、彼らは意地の悪い、危険な連中だ。

## 4. コマンド
ローグでは、1つか2つの文字をタイプしてコマンドが投げられる。殆どのコマンドは、数字を前につけることで、それをn回繰り返す、ということになる。 (つまり、10sとタイプすると、 10回探すになる。)　繰り返すことが意味をなさない場合は、数字を前に付けても無視される。コマンドまたは繰り返し回数をキャンセルするには、<ESCAPE>をタイプすればいい。 コマンドのリストは少し長いが、ゲーム中に“?”とコマンド入力すれば、いつでも参照できる。各コマンドとその簡略な説明を下記にまとめた。
 

?

ヘルプ・コマンド。特定の文字をタイプすれば、その文字が表すコマンドが分かる。*で、すべてのコマンドのリストが表示される。

/

「画面上に見える○○は何？」と尋ねるコマンド。　/ の次に文字を入力し、その文字が何を意味するのかを質問する。例えば、/@ と入力すると、@ は君、プレイヤーのことである、という答えが返ってくる。

h, H, ^H

 	
左に移動。このコマンドで、左に1スペース移動する。大文字でHとタイプすれば、何かにぶつかるまで左に移動する。これは、すべての移動コマンドに共通のルールである。(つまり、L とタイプすれば、「lの方向に何かにぶつかるまで走る」ということになる。) control-hをタイプすると、指定した方向に、何か面白いもの、または壁にぶつかるまで移動する、ということになる。これは、大変便利だが説明しづらいコマンドなので、試してみるとよい。このルールも、すべての移動コマンドに共通で適用される。

j

下へ移動。

k

上へ移動。

l

右へ移動。

y

斜め左上に移動。

u

斜め右上に移動。

b

斜め左下に移動。

n

斜め右下に移動。

t

オブジェクトを投げる。tは、その後に方向を付けて使う。tのあとに方向をタイプしたら、その方向に投げる。(つまり、 “th” とタイプすると、“左に投げる”になる。)

f

どちらかが死ぬまで戦う。fの後に方向コマンドを入力すると、その方向にいる奴とどちらかが倒れるまで戦うことになる。

m

オブジェクトを拾わずにその上に移動する。指定した方向に、そこに拾えるものがあっても拾わずに、1スペース移動する。

z

杖に方向を指定し、“振る”。方向の指定が不要な杖もあるが、方向は指定しなければならない。

^

罠を識別する。地図上の罠の存在がわかっていても、それが何の罠だったか思い出せないとき、その罠の隣に移動して^ を、次にその罠のある方向をタイプすれば、識別できる。

s

罠と秘密のドアを探す。君のいる場所と直接接したスペースに罠か秘密のドアがないか、探すのだ。すぐ隣に何かがあっても、君にはそれがみつけられないことがしょっちゅうあるため、この“探す”(search)コマンドが必要なのだ。

>

階段を(下の階に)降りる。当然だが、このコマンドは、君が階段の上に立っていなければ使えない。

<

階段を(上の階に)昇る。このコマンドは、イェンダーの魔除けを持っていなければ使えない。

.

休憩する。これは“何もしない”コマンドだ。待ちたいとき、回復したいときに使うのだ。

,

足の下の何かを拾う。君の足の下に何かがあるとしたら、その何かを拾うことができる。

i

所有物。 君が袋に入れて持ち運んでいるもののリストが表示される。

I

各所有物。君の袋の中の個々のアイテムが何かを表示する。

q

袋の中の薬を1つ飲み干す。

r

袋の中の巻物を1つ読む。

e

袋の食べ物を食べる。

w

武器を装備する。袋から武器を一つ取り出し、戦闘時に使えるよう、(今使っている武器があれば、それの代わりに)手に持つ。

W

鎧を着る。君は一度に一つの鎧しか着ることができない。このコマンドを使用する際は、追加で時間がかかる。

T

鎧を脱ぐ。呪いのかかった鎧は脱げない。このコマンドを使用する際は、追加で時間がかかる。

P

指輪をはめる。指輪は一度に2つしか身に付けることができない。(片手に1つずつだ。) 指輪を一つもはめていないときにこのコマンドを使うと、どちらの手にはめたいのか、聞かれる。すでに指輪を一つはめているときは、自動的に空いている方の手に二つ目がはめられる。 プログラムは、君が武器を使う手は、右手であると想定している。

R

指輪を外す。指輪を一つだけはめているときは、自動的にその指輪を外す。指輪を2つはめているときにこのコマンドを使うと、どちらの手の指輪を外したいのか、聞かれる。

d

オブジェクトをドロップする。袋の中から何か一つ取り出して、床に置く。1スペースには1つのオブジェクトしか置くことができない。身に付けている呪われたオブジェクトはドロップできない。

c

オブジェクトに名前をつける。袋の中にあるオブジェクトについて備忘のため、callコマンドを使って、そのオブジェクトに名前をつけることができる。拾った薬、巻物、指輪、杖などが何であるのか判別できたときや、袋の中のどの武器を今装備中なのか覚えておきたいときなどに使用する。

D

君がどんな物を発見(識別)したのか表示する。このコマンドをたたくと、どんなことを知りたいか聞かれる。特定の意味を持つ文字を入力すると(例えば薬を表す“!”)、どんな種類の入力したオブジェクトを発見したか(例えば“!”なら、自分で名前をつけたものも含めて、どんな薬を発見したか)が表示される。このコマンドは、薬、巻物、指輪、杖などに使える。

o

オプションの確認と設定。このコマンドの詳細についてはオプションのセクションで説明する。

^R

画面の再表示。エラーなどが表示された状態の画面を元に戻したい時に使うといい。

^P

最後のメッセージを再表示する。読み終わる前にメッセージが消えてしまった時に便利だ。ミスタイプしたコマンド以外の最後のメッセージを再表示してくれるので、^Pの代わりにうっかり間違った文字を入力してしまっても大丈夫だ。

<ESCAPE>

 	コマンド、プレフィクス、カウントをキャンセルする。
!

コマンドを実行するため、子シェルを起動する。

Q

ゲームをやめる。

S

現在のゲームをファイルに保存する。デフォルトのセーブ・ファイルを使いたいかどうか聞かれる。
注意: セーブしたゲームのコピーでゲームを再開することはできない。ゲーム再開時、セーブ・ファイルは削除される。危険な場所の直前でセーブをし、危険な場所で死んでしまったら、そのセーブ・ファイルでゲームを再開することを防ぐためだ。セーブされたゲームで再開するには、ファイル名をローグに引数として渡せばよい。

% rogue save_file

デフォルトのセーブ・ファイル(下記参照)から再開するためには、下記のようにタイプすればよい。

% rogue -r

v

プログラムのバージョンを表示する

)

現在装備中の武器を表示する。

]

現在装備中の鎧を表示する。

=

現在装備中の指輪を表示する。

@

メッセージのステータス・ラインを再表示する。

## 5. 部屋
ダンジョン内の部屋は、灯りがついていているか、暗い。灯りのともった部屋にはいってゆくと、すぐに部屋のすべてが画面上に表示される。暗い部屋に入ると、画面には通った所だけが表示される。部屋を出る時、部屋の中に居るすべてのモンスターは消える。暗がりでは、君は自分の全方向1スペース隣しか見えない。廊下は常に暗い。

## 6. 戦闘
モンスターを見つけ、戦いたいと思ったら、ぶつかってゆけばよい。こちらからあたってゆかない限り、モンスターは知らん顔をしていることが多い。 「君子危うきに近寄らず」で、こちらから攻撃を仕掛けないほうがよいことも多い。

## 7. 君が発見するもの
ダンジョンで何かみつけたら、拾ったらよい。その上を通過すれば、みつけたものを拾うことができる。 (“m” プレフィックス -上記参照- を使わないならだ。) 持ち物がいっぱいの時は、プログラムがそう教えてくれ、拾うことができない。持ち物がいっぱいでないなら、拾ったものは袋の中に入り、そのとき、それが何だったのか知ることができる。

オブジェクトを使うコマンドの多くは、どのオブジェクトを使いたいのか、君に聞いてくる。やっぱりよしておこう、と思ったら、<ESCAPE>をタイプすれば、コマンドは中止される。

鎧や武器のようなオブジェクトは、判別が容易だ。巻物や薬などは、同じゲーム内(ゲームをスタートして、ダンジョン内で死ぬか、自らやめるかするまで)では、同じラベルがついている同じ種類のオブジェクトは、必ず同じタイプであることを示している。しかし、オブジェクトに付いているラベルは、ゲームごとに異なる。つまり、再度開始したゲームでは、前のゲームでみたラベルが同じタイプのオブジェクトを示すわけではないのだ。

こうしたラベル付きのオブジェクトを使ったとき、もしもその効果が明らかである場合、ローグは、それが君にとって何であったかを覚えておいてくれる。もしもその効果があまり明らかでなかった場合、あとで思い出せるよう、そのオブジェクトに何と書いておきたいか聞かれる。‘call’コマンド(前述参照)を使っても良い。

7.1. 武器
矢のような武器は複数まとめて落ちているが、他の殆どの武器は、1つずつ落ちている。武器を使うためには、その武器を装備する必要がある。弓矢で攻撃するためには、最初に弓を装備し、それから矢を射るのだ。武器は一度に一つしか装備できない。装備中の武器が呪われていたら、外すことができないため、他の武器を装備することはできない。武器を使うコマンドは“w”(装備) 、そして“t”(投げる)だ。

7.2. 鎧
ダンジョン内にはさまざまな種類の鎧が落ちている。あるものは強化されているし、あるものはされていない。鎧ごとに防御力も違う。防御力の数字が高いほど、モンスターの攻撃に耐えられる。下記リストは、鎧のタイプとそれぞれの防御力だ:

Type	タイプ	防御力
None	無し	0
Leather armor	革の鎧	2
Studded leather / Ring mail	鋲(ビョウ)を打った革の鎧/ 環状鎖帷子	3
Scale mail	鱗状鎖帷子	4
Chain mail 	鎖帷子 	5
Banded mail / Splint mail	鋼板と革の鎧 / 鋼板の鎧	6
Plate mail    	鋼の鎧    	7
 

鎧は強化されていると、防御力が通常よりアップする。呪われていると、防御力は下がるし、脱ぐことができない。しかし、通常よりも防御力が低い鎧が必ずしも呪われているとは限らない。

鎧を装備するは“W”、脱ぐは“T”である。

7.3. 巻物
巻物には不思議な言語3でタイトルが書かれている。巻物は読むとなくなってしまう。巻物を読むためには、コマンド“r”を使う。

7.4. 薬
薬には、フラスコの中の液体の色のラベルが付いている。薬は飲むとなくなってしまう。薬を飲む、は“q”だ。

7.5. 杖
2種類の杖(staffとwand)はどちらも同じように使うことができる。Staffには木の名前、Wandには金属や骨の名前がついている。杖は離れた場所に向けて使用することが多いため、何に対して使うのか指定しなければならない。しかし杖によっては、示した方向に関係なく使えるものもある。杖の魔法は、何回か使用するとなくなってしまう。効果が切れた杖は、ただの木や金属の棒になる。杖が何回使えるか、その数はランダムだ。

杖を使う時のコマンドは“z”だ。

7.6. 指輪
魔法の効果が有限であるポーション、巻物、杖と違って、効果がずっと続く指輪はとても便利なアイテムだ。もちろん、悪い指輪はもっと強力だ。殆どの指輪は、装備しているとお腹の減るスピードが上がってしまう。どのくらいのスピードで減るかは、指輪によって違う。指輪は、付いている宝石の名前で識別される。指輪は、“P”で装着、“R”で外すことができる。

7.7. 食べ物
ダンジョンで冒険を続けるためには、食べ物が必要だ。ずっと食べずにいると、君は気を失い、ついには餓死してしまう。食べ物を食べる時は、“e”と入力する。

## 8. オプション
プレーヤーは、オプションを使って、自分の嗜好や、ゲームをどのように動作させたいか、指定することができる。

8.1 オプションの設定
オプションを設定する方法は２つある。一つは“o”コマンドを使って、もう一つは“ROGUEOPTS”環境変数を使っての設定である。

8.1.1. ‘o’コマンドを使う
ローグで“o”を入力すると、ゲーム画面が消え、すべてのオプションに対する現在の設定が表示される。最初のオプションの値にカーソルがあたり、君の入力を待っている。リターン・キーで次のオプションに、“-”で一つ前のオプションに移動し、エスケープ・キーでゲームに戻る。オプションには値を入れることができる。 ブーリアン・オプションでは、“t”(true)か“f”(false)を入力する。 ストリング・オプションでは、値を入力してリターン・キーを押下する。

8.1.2. ROGUEOPTS変数を使う
ROGUEOPTS 変数は、カンマで区切られたオプションの初期値のリストの文字列である。ブーリアン変数は、変数の名前の前に“no”を前があればオフになる。つまり、環境変数jumpをオンに、terseをオフに、そしてnameを“Blue Meanie”にするには、下記のように設定すればいい。

% setenv ROGUEOPTS "jump,noterse,name=Blue Meanie"4

8.2. オプション・リスト
以下がオプション・リストとその解説だ。[]内がデフォルトの値である。文字入力させるストリング・オプションでは、50文字までが有効だ。(51文字以上は無視される)

terse [noterse]

ローグの、時に長いメッセージを読むことに疲れた、というプレーヤーには便利だ。遅い端末で遊んでいるときに便利なオプションだ。遅い (1200 baud 以下) 端末では、デフォルトでterseである。

jump [nojump]

このオプションが設定されていると、走り出してから次に停止するまでのアニメーションがスキップされる。この設定で、CPUと表示時間が大幅にセーブできる。遅い端末を使っているときは、このオプションはjumpに設定しておけばよい。

flush [noflush]

すべての先行入力は、戦闘の各ラウンドの後に捨てられる。この設定は、先にたっぷり入力してしまい、こうもりに殺されるのを、呆然と眺めているしかないといった悲劇を避けるのに有効だ。

seefloor [seefloor]

暗い部屋の中を移動する際、君の周りの床を表示する。床を表示にたくさんの文字を生成することになるため、遅い端末を使用しているなら、この設定はnoseefloorにしておくべきだ。

passgo [nopassgo]

廊下の曲がり角を判断する。もしも、君が回廊で走り、そして石か壁にぶつかったら、 自動的に左右どちらかに曲がる。もしも左右どちらかにしか曲がれないなら、自動的にそちらに曲がる。どちらにも曲がれるか、どちらにも曲がれないならそこで止まる。このアルゴリズムは、時々混乱をまねくことがあるため、デフォルトでnopassgoとなっている。

tombstone [tombstone]

君が死んだとき、墓標を表示するかどうかの設定だ。墓標表示はナイスだが、遅くなるので、オフにしておいてもよい。

inven [overwrite]

在庫表示のタイプを設定する。選択肢は3つ: overwriteかslowかclearだ。overwirteは、在庫リストを表示する時と、“Which item do you wish to . . .? ” という質問メッセージ(君は“*”でアイテムを指定する形で回答する)が出る時、マップの一番上のラインを在庫表示が上書きする。しかしもしも在庫リストが長くて、一度に画面表示できない場合は、画面はクリアされる。slowは、在庫アイテムは画面のトップに一つずつ表示される。clearは、画面はいったんクリアされ、在庫リストが表示され、その後ダンジョンのレベルが再表示される。表示速度を考慮し、clear-to-end-of-line機能の無い端末では、clearをデフォルトに設定すべきである。

name [account name]

君のキャラクターの名前だ。君がトップ10スコア・リストに載ったときに使われる。

fruit [slime-mold]

君が食べるフルーツの名前を指定できる。気まぐれに、ローグは複数の箇所でこの名前を使う。

file [~/rogue.save]

デフォルトのセーブ・ファイルの名前。もし君の回線が不意に切断されたら、ローグは自動でゲームをこのファイルにセーブする。ファイル名は、特別な意味のある文字“~”(君のホームディレクトリ名に展開される)ではじめても良い。

## 9. スコア
ローグは通常、トップ・プレーヤーのリスト、または君のマシンにあるスコア情報を保持している。どのように設定されているかにもよるが、ゲームはトップ・スコアかトップ・プレーヤーを記録する。後者の場合、マシン上の各アカウントは1つのスコアだけが記録される。もしも君がこのリストの他の誰かよりも高得点を獲得するか、リスト上の自己ベストを更新すると、君の順位があがり、君の名前が、適切な場所に掲載される。いくつの得点が保持されるかはゲームをマシンにインストールした時の設定次第だ。

ゲームを自らやめるとき、君はすべてのゴールドを持ってダンジョンから出ることができる。しかし君が運命の洞窟の中で殺されたら、保持していたゴールドの90%とともに君の体は家族の元に届けられる。残りの10%は、ダンジョンの賢者6に手数料として召し上げられる。モンスターとの戦闘中、生き延びることに賭けて最後に一発殴るか、そこでやめて、少なくとも持っているゴールドを温存するか、考えどころだ。今そこでやめれば、現在所持しているすべてのゴールドを得ることができるが、冒険を続けて、もっと生きながらえれば、もっとたくさん見つけられるかもしれない。

現在のトップ・プレーヤー/トップ・ゲームのリストを見たいときは、

% rogue −s

とタイプすればいい。

## 10. Web版RogueLike開発指針
往年のRPG「Rogue」の内容を参考にし、現代のWebブラウザ上で遊べるRogue Likeゲームを実装するための基本的な指針を以下に記す。

### 基本方針
- マップやイベントは毎回ランダムに生成し、探索と戦闘の流れは原作の雰囲気を尊重する。
- 画面表示はASCII表現を踏襲しつつ、HTML/CSSにより視認性を高める。
- 操作はキーボードを中心に行い、矢印キーやショートカットで移動・コマンドを入力できるようにする。

### 技術要件
- クライアント側はJavaScript(フレームワーク使用可)で実装し、ブラウザのみでプレイ可能とする。
- サーバ側にはNode.jsなどを用い、スコア記録やセーブデータの保存APIを提供する。
- 永続データはローカルストレージとサーバ保存の併用を想定する。

### 画面構成
- ダンジョン表示エリア、メッセージログ、ステータス欄を分割して表示する。
- コマンド一覧やヘルプをモーダル表示できるようにする。

### 今後の展開
- ランキング機能やイベント追加など、Webならではの拡張を段階的に検討する。

### サンプル実装
- `web` ディレクトリにExpressを用いた最小限のサーバーと、ASCII表示のみで動作する
  クライアントを同梱している。`npm start` を実行し `http://localhost:3000` にアクセ
  スすると簡単なRogueLikeが体験できる。
